#!/bin/sh
echo "initrd: alive"

sl_log() {
	echo "- \e[94m$*\e[0m"
}

sl_log "mount /dev"
mount -t devtmpfs none /dev
sl_log "mount /proc"
mount -t proc proc /proc

for arg in $(cat /proc/cmdline); do
	case "$arg" in
		root=*)
			root="${arg#root=}"
			;;
		rootfstype=*)
			rootfstype="${arg#rootfstype=}"
			;;
		init=*)
			init="${arg#init=}"
			;;
	esac
done

sl_log "mount /mnt"
mount -t ${rootfstype:-iso9660} -o ro ${root:-/dev/sr0} /mnt

sl_log "mount /mnt/proc"
mount -t proc proc /mnt/proc
sl_log "mount /mnt/sys"
mount -t sysfs sysfs /mnt/sys
sl_log "mount /mnt/dev"
mount -t devtmpfs none /mnt/dev

sl_log "running switch_root"
exec switch_root /mnt ${init:-/bin/sinit}